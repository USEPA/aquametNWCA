<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Karen Blocksom" />

<meta name="date" content="2017-03-02" />

<title>Calculate VMMI</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>



<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%7D%0Apre%20%7B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Calculate VMMI</h1>
<h4 class="author"><em>Karen Blocksom</em></h4>
<h4 class="date"><em>2017-03-02</em></h4>



<div id="preliminaries" class="section level2">
<h2>1 Preliminaries</h2>
<p>The Vegetation Multimetric Index (VMMI) is a measure of biological condition for wetlands and was developed based on NWCA 2011 vegetation data. The VMMI consists of 4 metrics, all calculated from vascular plant data. These are: Floristic Quality Assessment Index based on all species (FQAI_ALL), number of tolerant species (N_TOL), relative importance of native species (RIMP_NATSPP), and relative cover of native monocots (XRCOV_MONOCOTS_NAT). The scoring, or rescaling, of metrics, is based on interpolating between the 5th and 95th percentiles across all NWCA sites sampled nationwide. Then the scored metrics are summed and rescaled to a 100-point range for the VMMI score.</p>
<p>Assuming we are starting with raw plant data, we can use the function <code>calcVMMImets()</code> to calculate only the 4 metrics included in the VMMI. Then we can use the function <code>calcVMMI_fromMets()</code> to calculate the VMMI from the metric output.</p>
<p>Condition classes for the VMMI are based on combinations of aggregated wetland type and aggregated ecoregions. In order to obtain condition class assignments from the VMMI scores calculated in this function, we also need to include one of the following in the input data frame:</p>
<ul>
<li><strong>NWCA_ECO4</strong> (NWCA aggregated ecoregions) <em>and</em> <strong>NWCA_WET_GRP</strong> (NWCA aggregated wetland types)</li>
<li><strong>ECO_X_WETGRP</strong> (Combinations of ecoregions and wetland types in the two variables above)</li>
</ul>
<p>If none of these variables is present in the input data frame, the VMMI will be calculated but a warning will be generated, and no condition will be assigned.</p>
</div>
<div id="calculating-the-vmmi-metrics" class="section level2">
<h2>2 Calculating the VMMI metrics</h2>
<p>Using the vascular plant example dataset, <code>VascPlantEx</code> and the taxa lists included in the package, we first need to prepare the data for use in the <code>calcVMMImets()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(aquametNWCA)

<span class="kw">head</span>(VascPlantEx)</code></pre>
<pre><code>##   UID STATE USAC_REGION PLOT             USDA_NAME COVER
## 1   7    FL  CSTL_PLAIN    2 SAGITTARIA LANCIFOLIA    28
## 2   7    FL  CSTL_PLAIN    3 SAGITTARIA LANCIFOLIA     6
## 3   7    FL  CSTL_PLAIN    4 SAGITTARIA LANCIFOLIA     5
## 4   7    FL  CSTL_PLAIN    5 SAGITTARIA LANCIFOLIA    20
## 5   7    FL  CSTL_PLAIN    5       SPARTINA PATENS     0
## 6   7    FL  CSTL_PLAIN    1      PANICUM VIRGATUM     0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">exPlant &lt;-<span class="st"> </span><span class="kw">prepareData</span>(VascPlantEx, <span class="dt">sampID=</span><span class="st">'UID'</span>)</code></pre>
<pre><code>## [1] &quot;Done with plot summing&quot;
## [1] &quot;Done with sAMPID summing&quot;
## [1] &quot;Done with plot summing&quot;
## [1] &quot;Done with sAMPID summing&quot;
## [1] &quot;Done with plot summing&quot;
## [1] &quot;Done with sAMPID summing&quot;
## [1] &quot;Done preparing datasets&quot;</code></pre>
<p>Now we can use the <code>byUIDspp</code> data frame from the output above to calculate the VMMI. Then we need to cast the data frame into wide format.</p>
<pre class="sourceCode r"><code class="sourceCode r">mets &lt;-<span class="st"> </span><span class="kw">calcVMMImets</span>(exPlant$byUIDspp, <span class="dt">sampID=</span><span class="st">'UID'</span>)

<span class="kw">head</span>(mets)</code></pre>
<pre><code>##   UID          PARAMETER RESULT
## 1   1           FQAI_ALL  20.27
## 2   1        RIMP_NATSPP 100.00
## 3   1 XRCOV_MONOCOTS_NAT   0.60
## 4   1              N_TOL   8.00
## 5   2           FQAI_ALL  31.43
## 6   2              N_TOL  16.00</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now cast this data frame into wide format</span>
<span class="kw">library</span>(reshape2)
mets.wide &lt;-<span class="st"> </span><span class="kw">dcast</span>(mets,UID~PARAMETER,<span class="dt">value.var=</span><span class="st">'RESULT'</span>)
<span class="kw">head</span>(mets.wide)</code></pre>
<pre><code>##   UID FQAI_ALL N_TOL RIMP_NATSPP XRCOV_MONOCOTS_NAT
## 1   1    20.27     8      100.00               0.60
## 2   2    31.43    16       96.29               3.73
## 3   3    21.39     9       87.97              89.47
## 4   4    30.41    11       96.73               3.27
## 5   5    16.33     0      100.00              98.37
## 6   6    40.23    36       95.42              19.88</code></pre>
</div>
<div id="calculating-the-vmmi" class="section level2">
<h2>3 Calculating the VMMI</h2>
<p>Now we are ready to calculate the VMMI and assign a condition class. We need to merge a data frame with the necessary site-related variables. For the purposes of illustration, we will create that data frame here, but ideally it would be available in a separate data set or included in the input data frame above.</p>
<pre class="sourceCode r"><code class="sourceCode r">sites &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">UID=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="dt">NWCA_ECO4=</span><span class="kw">c</span>(<span class="st">'CPL'</span>,<span class="st">'CPL'</span>,<span class="st">'IPL'</span>,<span class="st">'CPL'</span>,<span class="st">'CPL'</span>,<span class="st">'IPL'</span>,<span class="st">'CPL'</span>,<span class="st">'CPL'</span>,<span class="st">'CPL'</span>,<span class="st">'CPL'</span>)
    ,<span class="dt">NWCA_WET_GRP=</span><span class="kw">c</span>(<span class="st">'PRLW'</span>,<span class="st">'PRLW'</span>,<span class="st">'PRLH'</span>,<span class="st">'PRLW'</span>,<span class="st">'PRLH'</span>,<span class="st">'PRLW'</span>,<span class="st">'EH'</span>,<span class="st">'EH'</span>,<span class="st">'PRLH'</span>,<span class="st">'PRLH'</span>)
    ,<span class="dt">ECO_X_WETGRP=</span><span class="kw">c</span>(<span class="st">'CPL-PRLW'</span>,<span class="st">'CPL-PRLW'</span>,<span class="st">'IPL-PRLH'</span>,<span class="st">'CPL-PRLW'</span>,<span class="st">'CPL-PRLH'</span>,<span class="st">'IPL-PRLW'</span>,<span class="st">'ALL-EH'</span>
                  ,<span class="st">'ALL-EH'</span>,<span class="st">'CPL-PRLH'</span>,<span class="st">'CPL-PRLH'</span>),<span class="dt">stringsAsFactors=</span>F)

mets.wide<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">merge</span>(sites, mets.wide, <span class="dt">by=</span><span class="st">'UID'</span>)

vmmi &lt;-<span class="st"> </span><span class="kw">calcVMMI_fromMets</span>(mets.wide<span class="fl">.1</span>, <span class="dt">sampID=</span><span class="st">'UID'</span>)
<span class="kw">head</span>(vmmi)</code></pre>
<pre><code>##   UID ECO_X_WETGRP FQAI_ALL_SC N_TOL_SC RIMP_NATSPP_SC VEGCOND VMMI
## 1   1     CPL-PRLW        4.21        8             10    FAIR 55.7
## 2   2     CPL-PRLW        7.74        6           9.33    GOOD 58.6
## 3   3     IPL-PRLH        4.57     7.75           7.84    GOOD 72.8
## 4   4     CPL-PRLW        7.42     7.25           9.41    GOOD   61
## 5   5     CPL-PRLH        2.97       10             10    GOOD   82
## 6   6     IPL-PRLW          10        1           9.18    GOOD 55.4
##   XRCOV_MONOCOTS_NAT_SC
## 1                  0.05
## 2                  0.37
## 3                  8.95
## 4                  0.32
## 5                  9.84
## 6                  1.98</code></pre>
<p>If we lack the ecoregion or wetland type information in the input data frame, the function still calculates the VMMI but generates a warning.</p>
<pre class="sourceCode r"><code class="sourceCode r">vmmi.alt &lt;-<span class="st"> </span><span class="kw">calcVMMI_fromMets</span>(mets.wide, <span class="dt">sampID=</span><span class="st">'UID'</span>)</code></pre>
<pre><code>## [1] &quot;Warning: Must include variables NWCA_WET_GRP and NWCA_ECO4 OR ECO_X_WETGRP to determine condition class. This variable is missing, and condition class will not be assigned, but VMMI will be calculated.&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(vmmi.alt)</code></pre>
<pre><code>##   UID FQAI_ALL_SC N_TOL_SC RIMP_NATSPP_SC VMMI XRCOV_MONOCOTS_NAT_SC
## 1   1        4.21     8.00          10.00 55.7                  0.05
## 2   2        7.74     6.00           9.33 58.6                  0.37
## 3   3        4.57     7.75           7.84 72.8                  8.95
## 4   4        7.42     7.25           9.41 61.0                  0.32
## 5   5        2.97    10.00          10.00 82.0                  9.84
## 6   6       10.00     1.00           9.18 55.4                  1.98</code></pre>
</div>
<div id="reference" class="section level2">
<h2>4 Reference</h2>
<p>US Environmental Protection Agency. 2016. National Wetland Condition Assessment: 2011 Technical Report. EPA-843-R-15-006. US Environmental Protection Agency, Washington, DC.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
